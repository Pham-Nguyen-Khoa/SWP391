extends ../../layouts/default.pug
include ../../mixins/alert.pug
include ../../mixins/mixin-title.pug

block main
    +alert-success("5000")
    +alert-error('5000')
    
    style.
        body {
        font-family: 'Arial', sans-serif;
        background-color: #f0f2f5;
        color: #333;
            }


        .page-title {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 1.5rem;
            color: #2c3e50;
        }

        .filter-section {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .form-select, .form-input, .btn {
            padding: 0.5rem 1rem;
            border: 1px solid #cbd5e0;
            border-radius: 0.375rem;
            font-size: 1rem;
        }

        .btn {
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background-color: #3498db;
            color: white;
        }

        .btn-primary:hover {
            background-color: #2980b9;
        }

        .table-container-feedback {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        #feedback-table {
            text-align: center;
            width: 100%;
            border-collapse: collapse;
        }
        #feedback-table thead tr th {
            text-align: center;
        }
        #feedback-table tbody tr td {
            text-align: center;
        }

        #feedback-table th, #feedback-table td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid #e2e8f0;
        }

        #feedback-table th {
            background-color: #f8fafc;
            font-weight: bold;
            color: #4a5568;
        }

        #feedback-table tr:hover {
            background-color: #f8fafc;
        }

        .id-cell {
            font-weight: bold;
            color: #3498db;
        }

        .star-rating {
            color: #d1d5db;
        }

        .star.filled {
            color: #f59e0b;
        }
        .star{
            font-size: 30px;
        }

        .status {
            padding: 0.25rem 0.5rem;
            border-radius: 9999px;
            font-size: 0.875rem;
            font-weight: 500;
        }

        .status-read {
            background-color: #10b981;
            color: white;
        }

        .status-unread {
            background-color: #f59e0b;
            color: white;
        }

        .action-cell {
            display: flex;
            gap: 0.5rem;
            justify-content: center;
        }
 

        .btn-view {
            background-color: #3498db;
            color: white;
        }

        .btn-view:hover {
            background-color: #2980b9;
        }

        .btn-delete {
            background-color: #e74c3c;
            color: white;
        }

        .btn-delete:hover {
            background-color: #c0392b;
        }

        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 1rem;
            margin-top: 1.5rem;
        }

        .btn-secondary {
            background-color: #95a5a6;
            color: white;
        }

        .btn-secondary:hover {
            background-color: #7f8c8d;
        }

        #page-info {
            font-weight: 500;
        }
        .filter-section {
        background: linear-gradient(to right, #4295b6, #8ed9cc);
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        margin-bottom: 20px;
        }

        .filter-section form {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            align-items: center;
        }

        .filter-section .form-input,
        .filter-section .form-select {
            flex: 1;
            min-width: 200px;
            padding: 10px;
            border: 1px solid #ced4da;
            border-radius: 4px;
            font-size: 14px;
            height: 43px;
        }

        .filter-section .btn {
            padding: 10px 20px;
            font-size: 14px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .filter-section .btn-primary {
            background-color: #007bff;
            color: white;
        }

        .filter-section .btn-primary:hover {
            background-color: #0056b3;
        }

        .filter-section .btn-secondary {
            background-color: #6c757d;
            color: white;
        }

        .filter-section .btn-secondary:hover {
            background-color: #545b62;
        }

        @media (max-width: 768px) {
            .filter-section form {
                flex-direction: column;
            }

            .filter-section .form-input,
            .filter-section .form-select,
            .filter-section .btn {
                width: 100%;
            }
        }


    .block-sider(style="width:90%;margin-left:180px;") 
        h1.page-title 
        +title("Quản lý Feedback")

        .filter-section
            form(action="/staff/feedback" method="get")
                input#date-filter.form-input(type="date" name="dateFilter" value=dateFilter)
                input#search-filter.form-input(type="text" name="searchFilter" placeholder="Tìm kiếm..." value=searchFilter)
                select#star-filter.form-select(name="starFilter" value=starFilter style="color: #e9b219; font-size: 22px;")
                    option(value="" selected) Tất cả sao
                    option(value="5" selected=starFilter==="5" class="star-option" style="color: #e9b219; font-size: 22px;")
                        |  5 sao ★★★★★
                    option(value="4" selected=starFilter==="4" class="star-option" style="color: #e9b219; font-size: 22px;")
                        |  4 sao ★★★★☆
                    option(value="3" selected=starFilter==="3" class="star-option" style="color: #e9b219; font-size: 22px;")
                        |  3 sao ★★★☆☆
                    option(value="2" selected=starFilter==="2" class="star-option" style="color: #e9b219; font-size: 22px;")
                        |  2 sao ★★☆☆☆
                    option(value="1" selected=starFilter==="1" class="star-option" style="color: #e9b219; font-size: 22px;" )
                        |  1 sao ★☆☆☆☆
                button#filter-button.btn.btn-primary Lọc
                button#reset-filter.btn(type="button") Tất cả

        .table-container-feedback
            h5
                if listFeedback.length === 0
                    if filterType === 'date'
                        p.alert.alert-info(style="text-align: center; margin: 20px; font-size: 1.5em; font-weight: bold;") Không có feedback nào trong ngày #{dateFormat}.
                    else if filterType === 'star'
                        case starFilter
                            when '5'
                                p.alert.alert-info(style="text-align: center; margin: 20px; font-size: 1.5em; font-weight: bold;") Không có feedback nào có 5 sao
                            when '4'
                                p.alert.alert-info(style="text-align: center; margin: 20px; font-size: 1.5em; font-weight: bold;") Không có feedback nào có 4 sao
                            when '3'
                                p.alert.alert-info(style="text-align: center; margin: 20px; font-size: 1.5em; font-weight: bold;") Không có feedback nào có 3 sao
                            when '2'
                                p.alert.alert-info(style="text-align: center; margin: 20px; font-size: 1.5em; font-weight: bold;") Không có feedback nào có 2 sao
                            when '1'
                                p.alert.alert-info(style="text-align: center; margin: 20px; font-size: 1.5em; font-weight: bold;") Không có feedback nào có 1 sao
                    else if filterType === 'search_star'
                        p.alert.alert-info(style="text-align: center; margin: 20px; font-size: 1.5em; font-weight: bold;") Không có feedback nào có tên khách hàng #{searchName} và #{starFilter} sao.
                    else if filterType === 'date_search'
                        p.alert.alert-info(style="text-align: center; margin: 20px; font-size: 1.5em; font-weight: bold;") Không có feedback nào có tên khách hàng #{searchName} trong ngày #{dateFormat}.
                    else if filterType === 'date_star'
                        p.alert.alert-info(style="text-align: center; margin: 20px; font-size: 1.5em; font-weight: bold;") Không có feedback nào có #{starFilter} sao trong ngày #{dateFormat}.
                    else if filterType === 'date_search_star'
                        p.alert.alert-info(style="text-align: center; margin: 20px; font-size: 1.5em; font-weight: bold;") Không có feedback nào có tên khách hàng #{searchName}, #{starFilter} sao trong ngày #{dateFormat}.
                    else if filterType ==='search'
                        p.alert.alert-info(style="text-align: center; margin: 20px; font-size: 1.5em; font-weight: bold;") Không có feedback nào có tên khách hàng #{searchName}.
                    else
                        p.alert.alert-info(style="text-align: center; margin: 20px; font-size: 1.5em; font-weight: bold;") Không có feedback nào phù hợp với các tiêu chí tìm kiếm.
                    
                    
                    
                else
                    table#feedback-table
                        thead
                            tr
                                th STT
                                th Khách hàng
                                th Ngày
                                th Nội dung
                                th Số sao
                                th Hành động
                        tbody
                            each feedback,index in listFeedback
                                tr
                                    td.id-cell #{ (currentPage - 1) * limit + index + 1} 
                                    td #{feedback.FullName} 
                                    td #{feedback.Time}
                                    td #{feedback.Content}
                                    td 
                                        .star-rating
                                            - for (var i = 0; i < feedback.Star; i++)
                                                span.star.filled ★
                                            - for (var i = 0; i < 5 - feedback.Star; i++)
                                                span.star ★
                                    td.action-cell
                                        button.btn.btn-view(onclick=`window.location.href="/staff/appointment/detail/${feedback.AppointmentID}"`) Xem
                            //- tr
                            //-     td.id-cell 2
                            //-     td Trần Thị B
                            //-     td 2023-07-14
                            //-     td Cần cải thiện thời gian giao hàng
                            //-     td 
                            //-         .star-rating
                            //-             - for (var i = 0; i < 3; i++)
                            //-                 span.star.filled ★
                            //-             - for (var i = 0; i < 2; i++)
                            //-                 span.star ★
                            //-     td.action-cell
                            //-         button.btn.btn-view Xem
                            //-         button.btn.btn-delete Xóa

                .pagination
                    if totalPages > 1
                        button#prev-page.btn.btn-secondary Trước
                        - for (var i = 1; i <= totalPages; i++)
                            if i === currentPage
                                button.btn.btn-primary #{i}
                            else
                                button.btn.btn-secondary #{i}
                        button#next-page.btn.btn-secondary Sau
                    else if totalPages === 1
                        button.btn.btn-primary 1

        script.
            const totalPages = #{totalPages};
            console.log(totalPages);
            document.getElementById('reset-filter').addEventListener('click', function() {
                //- document.getElementById('date-filter').value = '';
                //- document.getElementById('search-filter').value = '';
                //- document.getElementById('star-filter').value = '';
                window.location.href = '/staff/feedback';
            });
            const buttonPagination = document.querySelectorAll('.btn-secondary');
            buttonPagination.forEach(button => {
                button.addEventListener('click', function() {
                    const url = new URL(window.location.href);
                    let currentPage = url.searchParams.get('page') || 1;
                    if(this.id === 'prev-page'){
                        url.searchParams.set('page', parseInt(currentPage) - 1);
                    }
                    else if(this.id === 'next-page'){
                        url.searchParams.set('page', parseInt(currentPage) + 1);
                    }
                    else{
                        url.searchParams.set('page', button.textContent);
                    }
                    currentPage = url.searchParams.get('page') || 1;
                    window.location.href = url.toString();
                });
            });



            const currentPage = new URL(window.location.href).searchParams.get('page') || 1;
            const currentPageButton = document.querySelector(`.pagination .btn:not(#prev-page):not(#next-page):nth-child(${parseInt(currentPage) + 1})`);
            if (currentPageButton) {
                currentPageButton.classList.add('btn-primary');
                currentPageButton.classList.remove('btn-secondary');
                if(currentPage === '1'){
                    document.getElementById('prev-page').style.display = 'none'; 
                }
                console.log(currentPage);
                if(parseInt(currentPage) === totalPages){
                    document.getElementById('next-page').style.display = 'none'; 
                }
            }